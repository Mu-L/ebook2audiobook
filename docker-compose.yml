version: "3.9"

services:
  ebook2audiobook:
    # Uncomment to use pre-built image instead of building locally
    # image: docker.io/athomasson2/ebook2audiobook:latest
    image: ${BUILD_NAME:-ebook2audiobook:latest}
    build:
      context: .
      dockerfile: Dockerfile
      args:
        APP_VERSION: "25.12.12"
        DEVICE_TAG: cpu   # override with environment variable if needed
    container_name: ebook2audiobook
    working_dir: /app
    entrypoint: ["python", "app.py", "--script_mode", "full_docker"]
    command: []  # Add extra app parameters here if needed
    tty: true
    stdin_open: true
    ports:
      - "7860:7860"
    privileged: false
    group_add:
      - video
      - render
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    volumes:
      - .:/app:rw  # Full project bind â€” all folders (ebooks, audiobooks, etc.) synced instantly
    restart: unless-stopped

volumes:
  audiobooks:  # Optional: use named volume for persistence if you prefer