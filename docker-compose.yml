version: "3.9"

services:
  ebook2audiobook:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        BASE: python:3.12
    container_name: ebook2audiobook
    working_dir: /app

    # Runtime command NOT needed — ENTRYPOINT in Dockerfile already runs app.py
    command: []

    # Map port for Gradio
    ports:
      - "7860:7860"

    # Optional: mount your local directory only if you want to override local files
    # volumes:
    #   - ./:/app

    # GPU support if present (auto-ignore on systems without GPUs)
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: ["gpu"]

    # On macOS or CPU-only → Docker silently ignores the GPU section